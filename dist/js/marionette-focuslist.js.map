{"version":3,"file":"marionette-focuslist","sources":["marionette-focuslist/src/templates.js","marionette-focuslist/src/views/focusList.js","marionette-focuslist/src/index.js"],"sourcesContent":["import handlebars from 'handlebars'\n\nexport default {\n'focusList': handlebars.template({\"compiler\":[7,\">= 4.0.0\"],\"main\":function(container,depth0,helpers,partials,data) {\n    return \"<div class=\\\"nano\\\">\\n  <div class=\\\"nano-content\\\" region=\\\"list\\\">\\n    <ul></ul>\\n  </div>\\n</div>\\n\";\n},\"useData\":true}),\n}\n","\nimport _ from 'lodash'\n\nimport animation from 'animation'\nimport marionette from 'marionette'\n\nimport templates from '../templates'\n\nconst ListView = marionette.CollectionView.extend({\n  tagName: 'ul',\n  childEvents: {\n    focus: 'onChildFocus',\n    select: 'onChildSelect'\n  },\n  onChildFocus: function (child) {\n    if (child.$el.is(':not(.disabled)')) {\n      this.$el.children().removeClass('focus')\n      child.$el.addClass('focus')\n    }\n  },\n  onChildSelect: function (child) {\n    this.trigger('select', child)\n  }\n})\n\nexport default marionette.LayoutView.extend({\n  template: templates['focusList'],\n  attributes: {\n    class: 'focusList'\n  },\n  events: {\n    'keydown': 'onKeyDown'\n  },\n  regions: {\n    list: '[region=list]'\n  },\n  ui: {\n    scroll: '.nano',\n    content: '.nano-content'\n  },\n  keyEvents: {\n    13: 'onEnterKey',\n    32: 'onSpaceKey',\n    38: 'onArrowUpKey',\n    40: 'onArrowDownKey'\n  },\n  initialize: function (options) {\n    this.maxSize = options.maxSize\n    this.childView = options.childView\n    this.collection = options.collection\n  },\n  onShow: function () {\n    this.refreshScroll()\n  },\n  onAttach: function () {\n    this.resetHeight()\n  },\n  onRender: function () {\n    this.listView = new ListView({\n      childView: this.childView,\n      collection: this.collection\n    })\n    this.listenTo(this.listView, 'select', (child) => {\n      this.trigger('select', child)\n    })\n    this.showChildView('list', this.listView)\n  },\n  onKeyDown: function (e) {\n    var method = this.keyEvents[e.keyCode]\n    if (method !== undefined) {\n      this[method]()\n      e.preventDefault()\n    }\n  },\n  onArrowUpKey: function () {\n    let focusedView = this.findFocusedItem()\n    if (focusedView === undefined) {\n      this.listView.$el.children().last().addClass('focus')\n    } else {\n      let items = this.listView.$el.children(':not(.disabled)')\n      let index = items.index(focusedView.el)\n      index = index - 1\n      index = (index < 0) ? (items.length - 1) : index\n      this.focusItem(items, index)\n    }\n  },\n  onArrowDownKey: function () {\n    var focusedView = this.findFocusedItem()\n    if (focusedView === undefined) {\n      this.listView.$el.children().first().addClass('focus')\n    } else {\n      var items = this.listView.$el.children(':not(.disabled)')\n      var index = items.index(focusedView.el)\n      index = index + 1\n      index = (index > (items.length - 1)) ? 0 : index\n      this.focusItem(items, index)\n    }\n  },\n  onEnterKey: function () {\n    this.itemSelect()\n  },\n  onSpaceKey: function () {\n    this.itemSelect()\n  },\n  focusItem: function (items, index) {\n    var item = items.eq(index)\n    items.removeClass('focus')\n    item.addClass('focus')\n    animation.scroll(item, this.ui.content)\n  },\n  filter: function (child) {\n    return !(child.get('visible') === false)\n  },\n  itemSelect: function (e) {\n    var focusedView = this.findFocusedItem()\n    this.listView.$el.children().removeClass('focus')\n    if (focusedView !== undefined) {\n      this.trigger('select', focusedView)\n    }\n  },\n  findFocusedItem: function () {\n    return this.listView.children.find(function (child) {\n      return child.$el.hasClass('focus')\n    })\n  },\n  findByModel: function (model) {\n    return this.listView.children.findByModel(model)\n  },\n  refreshScroll: function () {\n    this.ui.scroll.nanoScroller({alwaysVisible: true})\n  },\n  resetHeight: function () {\n    this.$el.css('height', `${this.getListHeight()}px`)\n  },\n  getListHeight: function () {\n    var el = this.listView.$el\n    var height\n    if (this.maxSize) {\n      // Calculate the height according to the maximum size\n      var firstItem = el.find('li').eq(0)\n      var itemHeight = firstItem.outerHeight()\n      height = _.min([el.height(), (itemHeight * this.maxSize)])\n      // Determine and add the outer border widths\n      var topBorderWidth = el.css('border-top-width')\n      var bottomBorderWidth = el.css('border-bottom-width')\n      topBorderWidth = parseInt(topBorderWidth, 10)\n      bottomBorderWidth = parseInt(bottomBorderWidth, 10)\n      height += (topBorderWidth + bottomBorderWidth)\n      // Determine and add the list padding\n      var paddingTop = el.css('padding-top')\n      var paddingBottom = el.css('padding-bottom')\n      paddingTop = parseInt(paddingTop, 10)\n      paddingBottom = parseInt(paddingBottom, 10)\n      height += paddingTop + paddingBottom\n    } else {\n      height = el.outerHeight()\n    }\n    // Return the calculated height\n    return height\n  },\n  getListWidth: function () {\n    var width = null\n    this.ui.content.css({position: 'relative'})\n    width = this.$el.outerWidth()\n    this.ui.content.css({position: 'absolute'})\n    return width\n  }\n})\n","\nimport FocusListView from './views/focusList'\n\nexport default {\n  FocusListView\n}\n"],"names":["handlebars","template","container","depth0","helpers","partials","data","ListView","marionette","CollectionView","extend","tagName","childEvents","focus","select","onChildFocus","child","$el","is","children","removeClass","addClass","onChildSelect","trigger","LayoutView","templates","attributes","class","events","regions","list","ui","scroll","content","keyEvents","initialize","options","maxSize","childView","collection","onShow","refreshScroll","onAttach","resetHeight","onRender","listView","listenTo","showChildView","onKeyDown","e","method","keyCode","undefined","preventDefault","onArrowUpKey","focusedView","findFocusedItem","last","items","index","el","length","focusItem","onArrowDownKey","first","onEnterKey","itemSelect","onSpaceKey","item","eq","animation","filter","get","find","hasClass","findByModel","model","nanoScroller","alwaysVisible","css","getListHeight","height","firstItem","itemHeight","outerHeight","_","min","topBorderWidth","bottomBorderWidth","parseInt","paddingTop","paddingBottom","getListWidth","width","position","outerWidth","FocusListView"],"mappings":"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"}